p8105_hw3_WL3011
================
Weiqi Liang
2024-10-12

## Setup File

``` r
library(tidyverse)
library(dplyr)
library(knitr)
library(kableExtra)
library(ggplot2)
```

## Problem 1

Firstly load the data.

``` r
library(p8105.datasets)
data("ny_noaa")
```

Dataset **NY NOAA** has 2595176 rows and 7 columns, showing a list of
all GHCND-Daily weather stations in New York state with weather data,
respectively. The variables include:

- `id`: Weather station ID
- `date`: Date of observation
- `prcp`: Precipitation ($10^{-1}$ mm)
- `snow`: The amount of snowfall (mm)
- `snwd`: Snow depth (mm)
- `tmax`: Maximum temperature ($10^{-1}$ °C)
- `tmin`: Minimum temperature ($10^{-1}$ °C)

### 1.1 Data Cleaning

- Create separate variables for year, month, and day.
- Convert `prcp`, `tmax`, `tmin` to standard units, i.e., mm and degree
  Celsius, respectively.

``` r
# basic dataset: ny_noaa
ny_noaa = ny_noaa |>

  mutate(
    year = format(pull(ny_noaa, date), "%Y"),
    month = format(pull(ny_noaa, date), "%m"),
    day = format(pull(ny_noaa, date), "%d")
    ) |>
  relocate(id, date, year, month, day) |> 
  mutate(
    across(-c(date, id), as.numeric),
    prcp = prcp / 10,     
    tmax = tmax / 10,     
    tmin = tmin / 10      
  )
```

``` r
snowfall_frequency = ny_noaa |>
  count(snow, sort = TRUE)  # sort = TRUE means descending
head(snowfall_frequency)
```

    ## # A tibble: 6 × 2
    ##    snow       n
    ##   <dbl>   <int>
    ## 1     0 2008508
    ## 2    NA  381221
    ## 3    25   31022
    ## 4    13   23095
    ## 5    51   18274
    ## 6    76   10173

``` r
snowfall_df = ny_noaa |>
  filter(!is.na(snow)) |>
  mutate(snowfall_category = ifelse(snow == 0, "Zero", "Non-Zero")) |>
  count(month, snowfall_category)

# bar plot
ggplot(snowfall_df, aes(x = month, y = n, fill = snowfall_category)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    x = "Month", 
    y = "Frequency"
    ) +
  scale_fill_manual(
    name = "Snowfall (mm)", 
    values = c("Zero" = "orange", "Non-Zero" = "skyblue")
    ) +
  scale_x_continuous(breaks = 1:12) + 
  theme_minimal()
```

<figure>
<img src="p8105_hw3_WL3011_files/figure-gfm/SNOW-1.png"
alt="Figure 1. Frequency of Zero and Non-Zero Snowfall(mm) by Month" />
<figcaption aria-hidden="true">Figure 1. Frequency of Zero and Non-Zero
Snowfall(mm) by Month</figcaption>
</figure>

- For `snow`, the most commonly observed values is **0**. from the
  figure above, it is obvious that the number of snowy days is far fewer
  than the number of non-snowy days. Therefore, the most observed amount
  of snowfall is 0.

### 1.2 Average Max Temperature

Plot below shows the average max temperature in January and in July in
each station across years.

``` r
# each stations' average max temperature in January & July 
avg_tmax_df = ny_noaa |> 
  filter(month == 1 | month == 7) |>
  group_by(id, month, year) |>
  mutate(
    avg_tmax = mean(tmax, na.rm = TRUE)
    ) |>
  ungroup() |>
  distinct(id, year, month, avg_tmax) |>
  pivot_wider(
    names_from = month, 
    values_from = avg_tmax,
    names_prefix = "month_"
  )

# two-panel plot
ggplot(avg_tmax_df, aes(x = year)) +
  geom_line(aes(y = month_1, color = "January", group = id), size = .1) +
  geom_line(aes(y = month_7, color = "July", group = id), size = .1) +
  geom_point(aes(y = month_1, color = "January"), size = .2) +
  geom_point(aes(y = month_7, color = "July"), size = .2) +
  scale_color_manual(
    values = c("January" = "skyblue", "July" = "orange"),
    breaks = c("July", "January")  
  ) +
  labs(
    x = "Year", 
    y = "Average Max Temperature (°C)", 
    color = "Month") +
  theme_minimal()
```

    ## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
    ## ℹ Please use `linewidth` instead.
    ## This warning is displayed once every 8 hours.
    ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
    ## generated.

    ## Warning: Removed 3261 rows containing missing values or values outside the scale range
    ## (`geom_line()`).

    ## Warning: Removed 3251 rows containing missing values or values outside the scale range
    ## (`geom_line()`).

    ## Warning: Removed 3329 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

    ## Warning: Removed 3348 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

<figure>
<img src="p8105_hw3_WL3011_files/figure-gfm/AMT-1.png"
alt="Figure 2. Average Max Temperature in January and July Across Years" />
<figcaption aria-hidden="true">Figure 2. Average Max Temperature in
January and July Across Years</figcaption>
</figure>

Figure @ref(fig:AMT) above shows a few patterns and observations stand
out:

- Seasonal Variation:

July consistently shows much higher average maximum temperatures (20 to
30°C) compared to January (-10 to 10°C). This reflects the typical
seasonal difference between winter and summer.

- Parallel Trends Across Stations

The year-to-year January and July maximum temperatures recorded at each
weather station maintain a parallel pattern, i.e., they have a similar
trend of change.

- Outliers:

There are a few sharp drops (e.g., July showing one or two sudden drops
below 20°C and January dipping below -10°C). These might indicate
unusual weather events.

- Noise in January Data:

Compared to the July data, the January data fluctuated more between 1981
and 2010 and had discrete extremes at some stations in 2004. This could
indicate that January weather is more unpredictable, perhaps due to
snow, storms, or varying cold fronts.

### 1.3 Plot

Make a two-panel plot showing (i) tmax vs tmin for the full dataset
(note that a scatterplot may not be the best option); and (ii) make a
plot showing the distribution of snowfall values greater than 0 and less
than 100 separately by year.

## II. Problem 2

## III. Problem 3
